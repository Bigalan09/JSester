<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
    <link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css" />
    <link rel="stylesheet" href="node_modules/codemirror/theme/monokai.css" />
    <style>
        blockquote,
        body,
        dd,
        div,
        dl,
        dt,
        fieldset,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        input,
        li,
        ol,
        p,
        pre,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #editor {
            height: calc(100vh - 60px);
        }

        #editor .panel-h,
        #editor .panel-v {
            overflow: auto;
            position: relative;
        }

        #editor .panel-v {
            float: left;
            height: 100%;
        }

        #editor .gutter.gutter-vertical {
            cursor: ns-resize;
        }

        #editor .gutter.gutter-horizontal {
            cursor: ew-resize;
            height: 100%;
            float: left;
        }

        #editor .gutter {
            background: #2d333b;
            position: relative;
        }

        body {
            background-color: #1e1e1e;
            color: #cfd0d2;
            font-family: "Source Code Pro", "Lucida Console", "Bitstream Vera Sans Mono", "Courier New", Courier, monospace;
            font-size: 12px;
            line-height: 1.4em;
            box-sizing: border-box;
        }

        a {
            outline: none;
        }

        #header {
            height: 60px;
            background: #1a1a1e;
            box-shadow: 0 0 5px rgba(28, 33, 40, 0.5);
            position: relative;
            z-index: 100;
            width: 100vw;
        }

        #editor .panel-h,
        #editor .panel-v {
            overflow: hidden;
        }

        #actions {
            height: 60px;
            font-size: 14px;
            position: relative;
            z-index: 300;
            margin-left: 6px;
        }

        #actions .actionCont {
            float: left;
        }

        #actions .actionItem.hidden {
            display: none;
        }

        #actions .actionItem.visible {
            display: block;
        }

        #actions .actionItem {
            float: left;
            position: relative;
            margin-right: 1px;
        }

        #actions .actionItem a.aiButton {
            display: block;
            outline: none;
            text-decoration: none;
            padding: 0 8px;
            line-height: 60px;
            color: #fbfbfb;
        }

        #actions .actionItem .aiButton,
        #actions .actionItem .aiButton span,
        #actions .dropdown .actionItem a.aiButton {
            height: 59px;
        }

        #actions svg {
            vertical-align: middle;
            position: relative;
            top: -1px;
            height: 16px;
        }

        .windowLabelCont {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 99;
        }

        .windowLabel {
            font-size: 12px;
            z-index: 30;
            color: #cfd0d2;
            line-height: 23px;
            padding: 7px 0 7px 10px;
            display: inline-block;
        }

        .windowLabel {
            text-decoration: none;
        }

        .editor, .run {
            height: calc(100% - 40px);
            position: relative;
            top: 40px;
        }
    </style>
</head>

<body>
    <div id="header">
        <div id="actions">
            <nav class="actionCont collapsed">
                <div class="actionItem">
                    <a class="aiButton" id="run" title="Shortcut: Command/Ctrl + Enter" href="#run">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"
                            stroke-linejoin="round" class="feather feather-play">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Run</a>
                </div>

                <div class="actionItem visible ">
                    <a class="aiButton" id="savenew" title="Shortcut: Command/Ctrl + S" href="#save">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"
                            stroke-linejoin="round" class="feather feather-upload-cloud">
                            <polyline points="16 16 12 12 8 16"></polyline>
                            <line x1="12" y1="12" x2="12" y2="21"></line>
                            <path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"></path>
                            <polyline points="16 16 12 12 8 16"></polyline>
                        </svg>
                        Save</a>
                </div>
            </nav>
        </div>
    </div>
    <div id="editor">
        <div class="panel-v left" style="width: calc(50% - 0.5px);">
            <div id="p1" class="panel-h panel" style="height: calc(50% - 0.5px);">
                <div id="htmlEditor" class="editor"></div>
                <div class="windowLabelCont">
                    <a href="#" class="windowLabel" data-panel="html" data-popover-trigger="html">
                        <span class="label">HTML</span>
                    </a>
                </div>
            </div>
            <div id="p2" class="panel-h panel" style="height: calc(50% - 0.5px);">
                <div id="jsEditor" class="editor"></div>
                <div class="windowLabelCont">
                    <a href="#" class="windowLabel">
                        <span class="label">Javascript (pure JS)</span>

                    </a>
                </div>
            </div>
        </div>
        <div class="panel-v right" style="width: calc(50% - 0.5px);">
            <div id="p3" class="panel-h panel" style="height: calc(50% - 0.5px);">
                <div id="cssEditor" class="editor"></div>
                <div class="windowLabelCont">
                    <a href="#" class="windowLabel">
                        <span class="label">CSS</span>

                    </a>
                </div>
            </div>
            <div id="p4" class="panel-h panel" style="height: calc(50% - 0.5px);">
                <div id="preview" class="run"></div>
                <div class="windowLabelCont">
                    <a href="#" class="windowLabel">
                        <span class="label">Preview</span>

                    </a>
                </div>
            </div>
        </div>
    </div>
    <script src="split.js"></script>
    <script>
        Split(['.panel-v.left', '.panel-v.right'], {
            gutterSize: 2,
            cursor: 'col-resize'
        });

        Split(['#p1', '#p2'], {
            direction: 'vertical',
            sizes: [50, 50],
            gutterSize: 2,
            cursor: 'row-resize'
        })

        Split(['#p3', '#p4'], {
            direction: 'vertical',
            sizes: [50, 50],
            gutterSize: 2,
            cursor: 'row-resize'
        })

        let htmlArea = document.querySelector('#htmlEditor');
        let cssArea = document.querySelector('#cssEditor');
        let jsArea = document.querySelector('#jsEditor');
    </script>
    <script>
        // Monaco uses a custom amd loader that overrides node's require.
        // Keep a reference to node's require so we can restore it after executing the amd loader file.
        var nodeRequire = global.require;
    </script>
    <script src="node_modules/monaco-editor/min/vs/loader.js"></script>
    <script>
        // Save Monaco's amd require and restore Node's require
        var amdRequire = global.require;
        global.require = nodeRequire;
    </script>

    <script>
        // require node modules before loader.js comes in
        var path = require('path');
        let htmlEditor = null;
        let cssEditor = null;
        let jsEditor = null;
        let previewContainer = document.querySelector('#preview');

        function uriFromPath(_path) {
            var pathName = path.resolve(_path).replace(/\\/g, '/');
            if (pathName.length > 0 && pathName.charAt(0) !== '/') {
                pathName = '/' + pathName;
            }
            return encodeURI('file://' + pathName);
        }
        amdRequire.config({
            baseUrl: uriFromPath(path.join(__dirname, 'node_modules/monaco-editor/min'))
        });
        // workaround monaco-css not understanding the environment
        self.module = undefined;
        // workaround monaco-typescript not understanding the environment
        self.process.browser = true;

        amdRequire(['vs/editor/editor.main'], function () {
            htmlEditor = monaco.editor.create(htmlArea, {
                language: 'html',
                roundedSelection: false,
                scrollBeyondLastLine: false,
                readOnly: false,
                automaticLayout: true,
                theme: "vs-dark",
                minimap: {
                    enabled: false
                }
            });
            cssEditor = monaco.editor.create(cssArea, {
                language: 'css',
                roundedSelection: false,
                scrollBeyondLastLine: false,
                readOnly: false,
                automaticLayout: true,
                theme: "vs-dark",
                minimap: {
                    enabled: false
                }
            });
            jsEditor = monaco.editor.create(jsArea, {
                language: 'javascript',
                roundedSelection: false,
                scrollBeyondLastLine: false,
                readOnly: false,
                automaticLayout: true,
                theme: "vs-dark",
                minimap: {
                    enabled: false
                }
            });

            /*
            htmlEditor.onDidChangeModelContent((a, b, c) => {
                doRun(previewContainer);
            });
            cssEditor.onDidChangeModelContent((a, b, c) => {
                doRun(previewContainer);
            });
            jsEditor.onDidChangeModelContent((a, b, c) => {
                doRun(previewContainer);
            });
            */
        });

        var runIframe = null,
            runIframeHeight = 0;

        document.querySelector('#run').addEventListener('click', () => {
            doRun(previewContainer);
        });

        function doRun(runContainer) {
            if (runIframe) {
                // Unload old iframe
                runContainer.removeChild(runIframe);
            }

            // Load new iframe
            runIframe = document.createElement('iframe');
            runIframe.id = 'runner';
            runIframe.src = 'runner.html';
            runIframe.className = 'run-iframe';
            runIframe.style.boxSizing = 'border-box';
            runIframe.style.height = '100%';
            runIframe.style.width = '100%';
            runIframe.style.border = '0';
            runIframe.frameborder = '0';
            runContainer.appendChild(runIframe);

            runIframe.addEventListener('load', function (e) {
                runIframe.contentWindow.load(jsEditor.model.getValue(), htmlEditor.model.getValue(), cssEditor.model
                    .getValue());
            });
        }
    </script>
</body>

</html>